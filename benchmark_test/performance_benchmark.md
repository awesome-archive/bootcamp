# 性能指标

本文给出了milvus0.5.3各种不同类型索引的性能，旨在给用户提供一个参考。测试数据采用公开数据集sift1B，共有十亿条128维的向量。

本文中用到的一些符号及专用名词说明如下：

| 专用名词   | 解释                                     |
| ---------- | ---------------------------------------- |
| nq         | 查询的目标向量条目数，在搜索时定义。     |
| topk       | 与查询的目标向量最相似的 topk 个结果。   |
| total_time | 批量查询时的总查询时间                   |
| avg_time   | 批量查询时每个向量的平均查询时间         |
| nprobe     | 查询时需要搜索的分桶数目，在搜索时定义。 |

（注：测试性能与nprobe值相关，性能随着nprobe增大而降低，但是精确率会随之增加。用户可根据具体场景要求设置nprobe. 本次测试nprobe设置为32）

各类型索引如何选择可参考：https://milvus.io/cn/blogs/2019-12-03-select-index.md

### 索引：IVF_FLAT

cpu search

| nq   | topk | total_time | avg_time |
| ---- | ---- | ---------- | -------- |
| 1    | 1    | 0.6487     | 0.6487   |
| 1    | 10   | 0.6408     | 0.6408   |
| 1    | 100  | 0.6493     | 0.6493   |
|      |      |            |          |
| 10   | 1    | 1.1243     | 0.1124   |
| 10   | 10   | 0.9356     | 0.0936   |
| 10   | 100  | 1.3931     | 0.1393   |
|      |      |            |          |
| 50   | 1    | 1.2678     | 0.0254   |
| 50   | 10   | 1.2675     | 0.0253   |
| 50   | 100  | 1.3115     | 0.0262   |
|      |      |            |          |
| 100  | 1    | 2.2895     | 0.0229   |
| 100  | 10   | 3.1338     | 0.0313   |
| 100  | 100  | 2.1886     | 0.0219   |
|      |      |            |          |
| 500  | 1    | 14.0294    | 0.0281   |
| 500  | 10   | 14.0151    | 0.028    |
| 500  | 100  | 14.4321    | 0.0289   |
|      |      |            |          |
| 1000 | 1    | 22.0935    | 0.0221   |
| 1000 | 10   | 25.4936    | 0.0255   |
| 1000 | 100  | 25.901     | 0.0259   |

gpu search

| nq   | topk | total_time | avg_time |
| ---- | ---- | ---------- | -------- |
| 1    | 1    | 14.2485    | 14.2485  |
| 1    | 10   | 14.2673    | 14.2673  |
| 1    | 100  | 14.3479    | 14.3479  |
|      |      |            |          |
| 10   | 1    | 14.3771    | 1.4377   |
| 10   | 10   | 14.4297    | 1.443    |
| 10   | 100  | 14.3873    | 1.4387   |
|      |      |            |          |
| 50   | 1    | 14.498     | 0.29     |
| 50   | 10   | 14.4178    | 0.2884   |
| 50   | 100  | 14.3513    | 0.287    |
|      |      |            |          |
| 100  | 1    | 14.6015    | 0.146    |
| 100  | 10   | 14.4465    | 0.1445   |
| 100  | 100  | 14.6844    | 0.1468   |
|      |      |            |          |
| 500  | 1    | 14.6073    | 0.0292   |
| 500  | 10   | 14.6434    | 0.0293   |
| 500  | 100  | 14.9968    | 0.03     |
|      |      |            |          |
| 1000 | 1    | 15.3294    | 0.0153   |
| 1000 | 10   | 15.3135    | 0.0153   |
| 1000 | 100  | 15.3364    | 0.0153   |

### 索引：sq8

cpu search

| nq   | topk | total_time | avg_time |
| ---- | ---- | ---------- | -------- |
| 1    | 1    | 0.6416     | 0.6416   |
| 1    | 10   | 0.6433     | 0.6433   |
| 1    | 100  | 0.6541     | 0.6541   |
|      |      |            |          |
| 10   | 1    | 1.0057     | 0.1006   |
| 10   | 10   | 1.0391     | 0.1039   |
| 10   | 100  | 1.0289     | 0.1029   |
|      |      |            |          |
| 50   | 1    | 0.9738     | 0.0195   |
| 50   | 10   | 0.8948     | 0.0179   |
| 50   | 100  | 2.0333     | 0.0407   |
|      |      |            |          |
| 100  | 1    | 1.5835     | 0.0158   |
| 100  | 10   | 1.584      | 0.0158   |
| 100  | 100  | 1.6095     | 0.0161   |
|      |      |            |          |
| 500  | 1    | 4.2526     | 0.0085   |
| 500  | 10   | 4.4623     | 0.0089   |
| 500  | 100  | 5.6541     | 0.0113   |
|      |      |            |          |
| 1000 | 1    | 9.0937     | 0.0091   |
| 1000 | 10   | 9.1369     | 0.0091   |
| 1000 | 100  | 9.5043     | 0.0095   |

gpu search

| nq   | topk | total_time | avg_time |
| ---- | ---- | ---------- | -------- |
| 1    | 1    | 5.1387     | 5.1387   |
| 1    | 10   | 5.0663     | 5.0663   |
| 1    | 100  | 5.0685     | 5.0685   |
|      |      |            |          |
| 10   | 1    | 5.1336     | 0.5134   |
| 10   | 10   | 5.0085     | 0.5009   |
| 10   | 100  | 5.1068     | 0.5107   |
|      |      |            |          |
| 50   | 1    | 5.0067     | 0.1001   |
| 50   | 10   | 5.0983     | 0.102    |
| 50   | 100  | 5.0527     | 0.1011   |
|      |      |            |          |
| 100  | 1    | 5.1222     | 0.0512   |
| 100  | 10   | 5.2778     | 0.0528   |
| 100  | 100  | 4.9544     | 0.0495   |
|      |      |            |          |
| 500  | 1    | 5.1924     | 0.0104   |
| 500  | 10   | 5.1253     | 0.0103   |
| 500  | 100  | 5.1715     | 0.0103   |
|      |      |            |          |
| 1000 | 1    | 5.1741     | 0.0052   |
| 1000 | 10   | 5.276      | 0.0053   |
| 1000 | 100  | 5.4707     | 0.0055   |

### 索引：sq8h

| nq   | topk | total_time | avg_time |
| ---- | ---- | ---------- | -------- |
| 1    | 1    | 0.3014     | 0.3014   |
| 1    | 10   | 0.2949     | 0.2949   |
| 1    | 100  | 0.3146     | 0.3146   |
|      |      |            |          |
| 10   | 1    | 0.5546     | 0.0555   |
| 10   | 10   | 0.5711     | 0.0571   |
| 10   | 100  | 0.6225     | 0.0623   |
|      |      |            |          |
| 50   | 1    | 0.6317     | 0.0126   |
| 50   | 10   | 0.6336     | 0.0127   |
| 50   | 100  | 0.6788     | 0.0136   |
|      |      |            |          |
| 100  | 1    | 0.9978     | 0.01     |
| 100  | 10   | 0.9975     | 0.01     |
| 100  | 100  | 1.0336     | 0.0103   |
|      |      |            |          |
| 500  | 1    | 2.729      | 0.0055   |
| 500  | 10   | 2.732      | 0.0055   |
| 500  | 100  | 2.9172     | 0.0058   |
|      |      |            |          |
| 1000 | 1    | 4.7836     | 0.0048   |
| 1000 | 10   | 4.8186     | 0.0048   |
| 1000 | 100  | 5.1465     | 0.0051   |
